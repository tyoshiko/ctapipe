

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HillasReconstructor &mdash; ctapipe v0.5.2.post13+gite7890e1</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="ctapipe v0.5.2.post13+gite7890e1" href="../index.html"/>
        <link rel="up" title="Reconstruction (reco)" href="../reco/index.html"/>
        <link rel="next" title="Reconstructor" href="ctapipe.reco.Reconstructor.html"/>
        <link rel="prev" title="Analysis with ImPACT" href="../reco/ImPACT.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ctapipe
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2.post13+gite7890e1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Command line tools (<code class="docutils literal"><span class="pre">tools</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/index.html">Analysis (<code class="docutils literal"><span class="pre">analysis</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calib/index.html">Calibration (<code class="docutils literal"><span class="pre">calib</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coordinates/index.html">Coordinates (<code class="docutils literal"><span class="pre">coordinates</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core Structures and Base Classes (<code class="docutils literal"><span class="pre">core</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow/index.html">Flow-based framework (<code class="docutils literal"><span class="pre">flow</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image/index.html">Imaging (<code class="docutils literal"><span class="pre">image</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../instrument/index.html">Instrument (<code class="docutils literal"><span class="pre">instrument</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html">Input/Output (<code class="docutils literal"><span class="pre">io</span></code>)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../reco/index.html">Reconstruction (<code class="docutils literal"><span class="pre">reco</span></code>)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../reco/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reco/index.html#currently-implemented-algorithms">Currently Implemented Algorithms</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../reco/index.html#reference-api">Reference/API</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../reco/index.html#module-ctapipe.reco">ctapipe.reco Package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../reco/index.html#classes">Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reco/index.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">Utilities (<code class="docutils literal"><span class="pre">utils</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">Visualization (<code class="docutils literal"><span class="pre">visualization</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ctapipe</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../reco/index.html">Reconstruction (<code class="docutils literal"><span class="pre">reco</span></code>)</a> &raquo;</li>
        
      <li>HillasReconstructor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/ctapipe.reco.HillasReconstructor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hillasreconstructor">
<h1>HillasReconstructor<a class="headerlink" href="#hillasreconstructor" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="ctapipe.reco.HillasReconstructor">
<em class="property">class </em><code class="descclassname">ctapipe.reco.</code><code class="descname">HillasReconstructor</code><span class="sig-paren">(</span><em>configurable=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">ctapipe.reco.reco_algorithms.Reconstructor</span></code></p>
<p>class that reconstructs the direction of an atmospheric shower
using a simple hillas parametrisation of the camera images it
provides a direction estimate in two steps and an estimate for the
shower’s impact position on the ground.</p>
<p>so far, it does neither provide an energy estimator nor an
uncertainty on the reconstructed parameters</p>
<p class="rubric">Methods Summary</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">fit_core_crosses</span></code>([unit])</td>
<td>calculates the core position as the least linear square solution</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">fit_core_minimise</span></code>([seed,&nbsp;test_function])</td>
<td>reconstructs the shower core position from the already set up</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">fit_origin_crosses</span></code>()</td>
<td>calculates the origin of the gamma as the weighted average</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">fit_origin_minimise</span></code>([seed,&nbsp;test_function])</td>
<td>Fits the origin of the gamma with a minimisation procedure this function expects that <a class="reference internal" href="#ctapipe.reco.HillasReconstructor.get_great_circles" title="ctapipe.reco.HillasReconstructor.get_great_circles"><code class="xref py py-obj docutils literal"><span class="pre">get_great_circles</span></code></a> has been run already.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_great_circles</span></code>(hillas_dict,&nbsp;subarray,&nbsp;…)</td>
<td>creates a dictionary of <code class="xref py py-class docutils literal"><span class="pre">GreatCircle</span></code> from a dictionary of</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code>(hillas_dict,&nbsp;inst,&nbsp;tel_phi,&nbsp;tel_theta)</td>
<td>The function you want to call for the reconstruction of the event.</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.fit_core_crosses">
<code class="descname">fit_core_crosses</code><span class="sig-paren">(</span><em>unit=Unit(“m”)</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.fit_core_crosses"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.fit_core_crosses" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the core position as the least linear square solution
of an (over-constrained) equation system</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">r_chisqr: numpy.ndarray(2)</p>
<blockquote>
<div><p>the minimum <span class="math">\(\chi^2\)</span> solution for the shower impact position</p>
</div></blockquote>
<p>pos_uncert: astropy length quantity</p>
<blockquote class="last">
<div><p>error estimate on the reconstructed core position</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The basis is the “trace” of each telescope’s <code class="xref py py-obj docutils literal"><span class="pre">GreatCircle</span></code> which
can be determined by the telescope’s position P=(Px, Py) and
the circle’s normal vector, projected to the ground n=(nx,
ny), so that for every r=(x, y) on the trace</p>
<p><span class="math">\(\vec n \cdot \vec r = \vec n \cdot \vec P\)</span> ,</p>
<p><span class="math">\(n_x \cdot x + n_y \cdot y = d\)</span></p>
<p>In a perfect world, the traces of all telescopes cross in the
shower’s point of impact. This means that there is one common
point (x, y) for every telescope, so we can write in matrix
form:</p>
<div class="math" id="equation-fullmatrix">
<span class="eqno">(1)<a class="headerlink" href="#equation-fullmatrix" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{pmatrix}
    nx_1  &amp;  ny_1  \\
    \vdots &amp; \vdots \\
    nx_n  &amp;  ny_n
\end{pmatrix}
    \cdot (x, y) =
\begin{pmatrix}
    d_1  \\
    \vdots \\
    d_n
\end{pmatrix}\end{split}\]</div>
<p>or <span class="math">\(\boldsymbol{A} \cdot \vec r = \vec D\)</span> .</p>
<p>Since we do not live in a perfect world and there probably is
no point r that fulfils this equation system, it is solved by
the method of least linear square:</p>
<div class="math" id="equation-rchisqr">
<span class="eqno">(2)<a class="headerlink" href="#equation-rchisqr" title="Permalink to this equation">¶</a></span>\[\vec{r}_{\chi^2} = (\boldsymbol{A}^\text{T} \cdot \boldsymbol{A})^{-1}
\boldsymbol{A}^\text{T} \cdot \vec D\]</div>
<p><span class="math">\(\vec{r}_{\chi^2}\)</span> minimises the squared difference of</p>
<div class="math">
\[\vec D - \boldsymbol{A} \cdot \vec r\]</div>
<p>Weights are applied to every line of equation <a class="reference internal" href="#equation-fullmatrix">(1)</a>
as stored in circle.weight (assuming they have been set in
<a class="reference internal" href="#ctapipe.reco.HillasReconstructor.get_great_circles" title="ctapipe.reco.HillasReconstructor.get_great_circles"><code class="xref py py-obj docutils literal"><span class="pre">get_great_circles</span></code></a> or elsewhere).</p>
</dd></dl>

<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.fit_core_minimise">
<code class="descname">fit_core_minimise</code><span class="sig-paren">(</span><em>seed=(0</em>, <em>0)</em>, <em>test_function=&lt;function dist_to_traces&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.fit_core_minimise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.fit_core_minimise" title="Permalink to this definition">¶</a></dt>
<dd><p>reconstructs the shower core position from the already set up
great circles</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>seed</strong> : tuple</p>
<blockquote>
<div><p>shape (2) tuple with optional starting coordinates
tuple of floats or astropy.length – if floats, assume metres</p>
</div></blockquote>
<p><strong>test_function</strong> : function object, optional (default: dist_to_traces)</p>
<blockquote class="last">
<div><p>function to be used by the minimiser</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The core of the shower lies on the cross section of the great
circle with the horizontal plane. The direction of this cross
section is the cross-product of the circle’s normal vector and
the horizontal plane.  Here, we only care about the direction;
not the orientation…</p>
</dd></dl>

<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.fit_origin_crosses">
<code class="descname">fit_origin_crosses</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.fit_origin_crosses"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.fit_origin_crosses" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the origin of the gamma as the weighted average
direction of the intersections of all great circles</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>gamma</strong> : shape (3) numpy array</p>
<blockquote>
<div><p>direction of origin of the reconstructed shower as a 3D vector</p>
</div></blockquote>
<p><strong>crossings</strong> : shape (n,3) list</p>
<blockquote class="last">
<div><p>list of all the crossings of the <code class="xref py py-obj docutils literal"><span class="pre">GreatCircle</span></code> list</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.fit_origin_minimise">
<code class="descname">fit_origin_minimise</code><span class="sig-paren">(</span><em>seed=(0</em>, <em>0</em>, <em>1)</em>, <em>test_function=&lt;function neg_angle_sum&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.fit_origin_minimise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.fit_origin_minimise" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits the origin of the gamma with a minimisation procedure this
function expects that <a class="reference internal" href="#ctapipe.reco.HillasReconstructor.get_great_circles" title="ctapipe.reco.HillasReconstructor.get_great_circles"><code class="xref py py-obj docutils literal"><span class="pre">get_great_circles</span></code></a>
has been run already. A seed should be given otherwise it defaults to
“straight up” supperted functions to minimise are an M-estimator and the
negative sum of the angles to all normal vectors of the great
circles</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>seed</strong> : length-3 array</p>
<blockquote>
<div><p>starting point of the minimisation</p>
</div></blockquote>
<p><strong>test_function</strong> : function object, optional (default: neg_angle_sum)</p>
<blockquote>
<div><p>either neg_angle_sum or MEst (or own implementation…)
neg_angle_sum seemingly superior to MEst</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>direction</strong> : length-3 numpy array as dimensionless quantity</p>
<blockquote class="last">
<div><p>best fit for the origin of the gamma from
the minimisation process</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.get_great_circles">
<code class="descname">get_great_circles</code><span class="sig-paren">(</span><em>hillas_dict</em>, <em>subarray</em>, <em>tel_phi</em>, <em>tel_theta</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.get_great_circles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.get_great_circles" title="Permalink to this definition">¶</a></dt>
<dd><p>creates a dictionary of <code class="xref py py-class docutils literal"><span class="pre">GreatCircle</span></code> from a dictionary of
hillas
parameters</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>hillas_dict</strong> : dictionary</p>
<blockquote>
<div><p>dictionary of hillas moments</p>
</div></blockquote>
<p><strong>subarray</strong> : ctapipe.instrument.SubarrayDescription</p>
<blockquote>
<div><p>subarray information</p>
</div></blockquote>
<p><strong>tel_phi, tel_theta</strong> : dictionaries</p>
<blockquote class="last">
<div><p>dictionaries of the orientation angles of the telescopes
needs to contain at least the same keys as in <code class="xref py py-obj docutils literal"><span class="pre">hillas_dict</span></code></p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="ctapipe.reco.HillasReconstructor.predict">
<code class="descname">predict</code><span class="sig-paren">(</span><em>hillas_dict</em>, <em>inst</em>, <em>tel_phi</em>, <em>tel_theta</em>, <em>seed_pos=(0</em>, <em>0)</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ctapipe/reco/HillasReconstructor.html#HillasReconstructor.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ctapipe.reco.HillasReconstructor.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>The function you want to call for the reconstruction of the
event. It takes care of setting up the event and consecutively
calls the functions for the direction and core position
reconstruction.  Shower parameters not reconstructed by this
class are set to np.nan</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>hillas_dict</strong> : python dictionary</p>
<blockquote>
<div><p>dictionary with telescope IDs as key and
MomentParameters instances as values</p>
</div></blockquote>
<p><strong>seed_pos</strong> : python tuple</p>
<blockquote>
<div><p>shape (2) tuple with a possible seed for
the core position fit (e.g. CoG of all telescope images)</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><strong>TooFewTelescopesException</strong></p>
<blockquote class="last">
<div><p>if len(hillas_dict) &lt; 2</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ctapipe.reco.Reconstructor.html" class="btn btn-neutral float-right" title="Reconstructor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../reco/ImPACT.html" class="btn btn-neutral" title="Analysis with ImPACT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright ctapipe developers.  Last updated 01 Aug 2017 15:35.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.2.post13+gite7890e1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>